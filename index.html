<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalkulator KP</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      max-width: 1200px;
      margin: 0 auto;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .title {
      font-size: 24px;
      color: #333;
    }
    .description {
      margin-top: 5px;
      color: #555;
    }
    .ubah-tarif-button {
      background-color: #ddd;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
    }
    .ubah-tarif-button:hover {
      background-color: #ccc;
    }
    .form-group {
      margin-bottom: 15px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }
    label {
      flex: 1;
      margin-right: 10px;
      font-weight: bold;
      color: #555;
    }
    input[type="text"], select, input[type="number"] {
      flex: 2;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      max-width: 20%; /* Batasi lebar input */
      text-align: left;
      font-size: 16px; /* Besarkan ukuran font input */
    }
    .unit-label {
      margin-left: 10px;
      font-weight: bold;
    }
    .tambah-properti-button {
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      border: none;
      border-radius: 4px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    .tambah-properti-button:hover {
      background-color: #0056b3;
    }
    #hasil {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
    }
    .property-list {
      margin-top: 20px;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      table-layout: fixed;
      font-size: 0.75em;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 8px;
      text-align: center;
      word-wrap: break-word;
    }
    th {
      background-color: #f0f0f0;
    }
    #total-hasil {
      margin-top: 10px;
      font-size: 16px;
      font-weight: bold;
      text-align: right;
    }
    .action-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .action-buttons button {
      width: 48%;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      color: white;
    }
    .simpan-button {
      background-color: #28a745;
    }
    .simpan-button:hover {
      background-color: #218838;
    }
    .reset-button {
      background-color: #dc3545;
    }
    .reset-button:hover {
      background-color: #c82333;
    }
    #ubahTarifModal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }
    #ubahTarifModal > div {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    #tarifTable input {
      width: 100px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 class="title">Kalkulator KP</h1>
        <p class="description">Kalkulator ini digunakan untuk menghitung kontribusi pembangunan berdasarkan kategori hunian atau non-hunian sesuai dengan luasan unit dan jumlah unit.</p>
      </div>
      <button class="ubah-tarif-button" onclick="checkPassword()">Ubah Tarif</button>
    </div>

    <!-- Input Form -->
    <div class="form-group">
      <label for="fungsi-proyek">Fungsi Proyek:</label>
      <select id="fungsi-proyek" name="fungsi-proyek">
        <optgroup label="Hunian">
          <option value="Landed House">Rumah Tapak (Landed House)</option>
          <option value="Condominium">Rumah Susun</option>
          <option value="Apartment">Apartemen</option>
        </optgroup>
        <optgroup label="Sarana Umum">
          <option value="University">Universitas</option>
          <option value="Clinic">Klinik</option>
          <option value="Laboratory">Laboratorium</option>
        </optgroup>
        <!-- Tambahkan opsi lainnya sesuai kebutuhan -->
      </select>
    </div>

    <!-- Input Nama Proyek -->
    <div class="form-group">
      <label for="nama-proyek">Nama Proyek:</label>
      <input type="text" id="nama-proyek" name="nama-proyek" required>
    </div>

    <!-- Input Luas Unit -->
    <div class="form-group">
      <label for="luas">Luas Unit:</label>
      <input type="number" id="luas" name="luas" step="0.01" min="0.01" required>
      <span class="unit-label">m²</span>
    </div>

    <!-- Input Jumlah Unit -->
    <div class="form-group">
      <label for="jumlah-unit">Jumlah Unit:</label>
      <input type="number" id="jumlah-unit" name="jumlah-unit" value="1" min="1" required>
      <span class="unit-label">unit</span>
    </div>

    <button class="tambah-properti-button" onclick="tambahProperti()">Tambah Properti</button>

    <div class="property-list" id="property-list" style="display: none;">
      <h3>Daftar Properti</h3>
      <table>
        <thead>
          <tr>
            <th>Fungsi/Kegiatan</th>
            <th>Kategori</th>
            <th>Kelompok Sub-Kategori</th>
            <th>Kode Sub-Kategori</th>
            <th>Luas Unit (m²)</th>
            <th>Jumlah Unit</th>
            <th>Tarif per m² (Rp)</th>
            <th>Total KP (Rp)</th>
          </tr>
        </thead>
        <tbody id="property-items"></tbody>
      </table>
      <div id="total-hasil"></div>

      <div class="action-buttons">
        <button class="simpan-button" onclick="simpanPDF()">Simpan</button>
        <button class="reset-button" onclick="resetSemua()">Reset</button>
      </div>
    </div>
  </div>

  <!-- Modal untuk mengubah tarif -->
  <div id="ubahTarifModal">
    <div>
      <h3>Ubah Tarif</h3>
      <table id="tarifTable">
        <thead>
          <tr>
            <th>Kode Sub-Kategori</th>
            <th>Tarif per m² (Rp)</th>
          </tr>
        </thead>
        <tbody>
          <!-- Baris tarif akan dimasukkan melalui JavaScript -->
        </tbody>
      </table>
      <button onclick="simpanTarifBaru()">Simpan Tarif</button>
      <button onclick="tutupModal()">Batal</button>
    </div>
  </div>

  <script>
    let tarifHunian = {
      H1: 33350, H2: 66700, H3: 100050, H4: 333500
    };

    let tarifNonHunian = {
      'Sarana Umum': { NH1: 83160, NH2: 166320, NH3: 249480 },
      'Komersial': { NH4: 496800, NH5: 745200, NH6: 993600 },
      'Industri': { NH7: 90890, NH8: 681675, NH9: 908900 }
    };

    let propertiList = [];

    function checkPassword() {
      const kodeAkses = prompt("Masukkan kode akses untuk mengubah tarif:");
      if (kodeAkses === "kpjepei2024") {
        ubahTarif();
      } else {
        alert("Kode akses salah.");
      }
    }

    function ubahTarif() {
      const modal = document.getElementById('ubahTarifModal');
      modal.style.display = 'flex';
      populateTarifTable();
    }

    function tutupModal() {
      const modal = document.getElementById('ubahTarifModal');
      modal.style.display = 'none';
    }

    function populateTarifTable() {
      const tarifTableBody = document.querySelector('#tarifTable tbody');
      tarifTableBody.innerHTML = '';
      const allTarif = { ...tarifHunian, ...tarifNonHunian['Sarana Umum'], ...tarifNonHunian['Komersial'], ...tarifNonHunian['Industri'] };
      for (let kode in allTarif) {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${kode}</td><td><input type="number" id="tarif-${kode}" value="${allTarif[kode]}"></td>`;
        tarifTableBody.appendChild(row);
      }
    }

    function simpanTarifBaru() {
      const allInputs = document.querySelectorAll('#tarifTable input');
      allInputs.forEach(input => {
        const kode = input.id.replace('tarif-', '');
        const nilaiBaru = parseFloat(input.value);
        if (tarifHunian.hasOwnProperty(kode)) {
          tarifHunian[kode] = nilaiBaru;
        } else {
          for (let kelompok in tarifNonHunian) {
            if (tarifNonHunian[kelompok].hasOwnProperty(kode)) {
              tarifNonHunian[kelompok][kode] = nilaiBaru;
            }
          }
        }
      });
      alert('Tarif berhasil disimpan!');
      tutupModal();
    }

    function tambahProperti() {
      const fungsiProyek = document.getElementById('fungsi-proyek').value;
      const namaProyek = document.getElementById('nama-proyek').value;
      const luas = parseFloat(document.getElementById('luas').value);
      const jumlahUnit = parseInt(document.getElementById('jumlah-unit').value);

      if (!fungsiProyek || !namaProyek || isNaN(luas) || isNaN(jumlahUnit)) {
        alert('Silakan isi semua kolom dengan benar.');
        return;
      }

      const kategori = fungsiProyek.includes("Sarana") ? 'Non-Hunian' : 'Hunian';
      const kelompok = kategori === 'Non-Hunian' ? 'Sarana Umum' : 'HUNIAN';
      const tarif = hitungTarif(kategori, kelompok, luas);
      const kodeSubKategori = hitungKodeSubKategori(kategori, kelompok, luas);
      const totalKP = luas * jumlahUnit * tarif;

      const properti = {
        fungsi: fungsiProyek, kategori, kelompok, kodeSubKategori, luas, jumlahUnit, tarif, totalKP
      };

      propertiList.push(properti);
      tampilkanProperti();
      resetForm();
    }

    function hitungTarif(kategori, kelompok, luas) {
      if (kategori === 'Hunian') {
        if (luas <= 35) return tarifHunian.H1;
        else if (luas <= 90) return tarifHunian.H2;
        else if (luas <= 350) return tarifHunian.H3;
        else return tarifHunian.H4;
      } else {
        if (luas <= 500) return tarifNonHunian[kelompok].NH1;
        else if (luas <= 5000) return tarifNonHunian[kelompok].NH2;
        else return tarifNonHunian[kelompok].NH3;
      }
    }

    function hitungKodeSubKategori(kategori, kelompok, luas) {
      if (kategori === 'Hunian') {
        if (luas <= 35) return 'H1';
        else if (luas <= 90) return 'H2';
        else if (luas <= 350) return 'H3';
        else return 'H4';
      } else {
        if (luas <= 500) return 'NH1';
        else if (luas <= 5000) return 'NH2';
        else return 'NH3';
      }
    }

    function tampilkanProperti() {
      const propertyItems = document.getElementById('property-items');
      propertyItems.innerHTML = '';
      let totalKeseluruhanKP = 0;
      propertiList.forEach(properti => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${properti.fungsi}</td><td>${properti.kategori}</td><td>${properti.kelompok}</td><td>${properti.kodeSubKategori}</td><td>${properti.luas}</td><td>${properti.jumlahUnit}</td><td>Rp ${properti.tarif.toLocaleString()}</td><td>Rp ${properti.totalKP.toLocaleString()}</td>`;
        propertyItems.appendChild(tr);
        totalKeseluruhanKP += properti.totalKP;
      });
      document.getElementById('total-hasil').textContent = `Total Keseluruhan KP: Rp ${totalKeseluruhanKP.toLocaleString()}`;
      document.getElementById('property-list').style.display = 'block';
    }

    function resetForm() {
      document.getElementById('fungsi-proyek').selectedIndex = 0;
      document.getElementById('luas').value = '';
      document.getElementById('jumlah-unit').value = '1';
    }

    function resetSemua() {
      if (confirm("Apakah Anda yakin ingin mereset semua data?")) {
        propertiList = [];
        document.getElementById('property-items').innerHTML = '';
        document.getElementById('total-hasil').textContent = '';
        document.getElementById('property-list').style.display = 'none';
        resetForm();
      }
    }

    function simpanPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(10);
      doc.text("Daftar Properti", 10, 10);
      let yPosition = 20;
      propertiList.forEach((properti, index) => {
        doc.text(`No: ${index + 1}`, 10, yPosition);
        doc.text(`Fungsi/Kegiatan: ${properti.fungsi}`, 10, yPosition + 5);
        doc.text(`Kategori: ${properti.kategori}`, 10, yPosition + 10);
        doc.text(`Kelompok Sub-Kategori: ${properti.kelompok}`, 10, yPosition + 15);
        doc.text(`Kode Sub-Kategori: ${properti.kodeSubKategori}`, 10, yPosition + 20);
        doc.text(`Luas (m²): ${properti.luas}`, 10, yPosition + 25);
        doc.text(`Jumlah Unit: ${properti.jumlahUnit}`, 10, yPosition + 30);
        doc.text(`Tarif per m² (Rp): Rp ${properti.tarif.toLocaleString()}`, 10, yPosition + 35);
        doc.text(`Total KP (Rp): Rp ${properti.totalKP.toLocaleString()}`, 10, yPosition + 40);
        yPosition += 50;
        if (yPosition > 270) {
          doc.addPage();
          yPosition = 20;
        }
      });
      doc.save("Daftar_Properti.pdf");
    }
  </script>
</body>
</html>
