<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalkulator KP</title>
  <!-- Menambahkan pustaka jsPDF untuk menyimpan PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      max-width: 1200px;
      margin: 0 auto;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .title {
      font-size: 24px;
      color: #333;
    }
    .description {
      margin-top: 5px;
      color: #555;
    }
    .ubah-tarif-button {
      background-color: #ddd;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
    }
    .ubah-tarif-button:hover {
      background-color: #ccc;
    }
    .form-group {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    label {
      flex: 1;
      margin-right: 10px;
      font-weight: bold;
      color: #555;
    }
    select, input {
      flex: 2;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      max-width: 30%; /* Lebar input dikurangi */
    }
    .unit-label {
      margin-left: 10px;
      font-weight: bold;
    }
    .tambah-properti-button {
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      border: none;
      border-radius: 4px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    .tambah-properti-button:hover {
      background-color: #0056b3;
    }
    #hasil {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
    }
    .property-list {
      margin-top: 20px;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      table-layout: fixed;
      font-size: 0.75em;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 8px;
      text-align: center;
      word-wrap: break-word;
    }
    th {
      background-color: #f0f0f0;
    }
    #total-hasil {
      margin-top: 10px;
      font-size: 16px;
      font-weight: bold;
      text-align: right;
    }
    .action-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .action-buttons button {
      width: 48%;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      color: white;
    }
    .simpan-button {
      background-color: #28a745;
    }
    .simpan-button:hover {
      background-color: #218838;
    }
    .reset-button {
      background-color: #dc3545;
    }
    .reset-button:hover {
      background-color: #c82333;
    }
    
    /* Modal CSS */
    #ubahTarifModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }
    #ubahTarifModal div {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 600px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 class="title">Kalkulator KP</h1>
        <p class="description">Kalkulator ini digunakan untuk menghitung kontribusi pembangunan berdasarkan kategori hunian atau non-hunian sesuai dengan luasan unit dan jumlah unit.</p>
      </div>
      <button class="ubah-tarif-button" onclick="ubahTarif()">Ubah Tarif</button>
    </div>
    
    <!-- Input Form -->
    <div class="form-group">
      <label for="fungsi-proyek">Fungsi Proyek:</label>
      <select id="fungsi-proyek" name="fungsi-proyek">
        <!-- Hunian -->
        <optgroup label="Hunian">
          <option value="Landed House">Rumah Tapak (Landed House)</option>
          <option value="Condominium">Rumah Susun</option>
          <option value="Apartment">Apartemen</option>
        </optgroup>
        <!-- Non-Hunian -->
        <optgroup label="Sarana Umum">
          <option value="University">Universitas</option>
          <option value="Clinic">Klinik, Praktek Dokter Bersama</option>
          <option value="Laboratory">Laboratorium</option>
          <option value="Hospital">Rumah Sakit</option>
          <option value="Recreation">Tempat Rekreasi Olahraga</option>
          <option value="Art Building">Gedung Kesenian</option>
          <option value="Sports Building">Gedung Olahraga</option>
        </optgroup>
        <optgroup label="Komersial">
          <option value="Rental Office">Kantor Sewa</option>
          <option value="Co-Working Space">Co-Working Space</option>
          <option value="Mall">Perbelanjaan/Mall</option>
          <option value="Shops">Pertokoan</option>
          <option value="Function Hall">Function Hall</option>
          <option value="Hotel">Hotel, Condotel, Serviced Apartment</option>
          <option value="Shophouse">Rukan, Ruko</option>
          <option value="Cafe">Kafe, Resto, Kedai</option>
          <option value="Showroom">Showroom</option>
          <option value="Marketing Office">Marketing Office</option>
          <option value="Workshop">Bengkel</option>
          <option value="Entertainment Venue">Tempat Hiburan</option>
        </optgroup>
        <optgroup label="Industri">
          <option value="Factory">Pabrik</option>
          <option value="Convection">Konveksi</option>
          <option value="Warehouse">Pergudangan</option>
          <option value="Batching Plant">Batching Plant</option>
        </optgroup>
      </select>
    </div>

    <div class="form-group">
      <label for="luas">Luas Unit:</label>
      <input type="number" id="luas" name="luas" step="0.01" min="0.01" required>
      <span class="unit-label">m²</span>
    </div>

    <div class="form-group">
      <label for="jumlah-unit">Jumlah Unit:</label>
      <input type="number" id="jumlah-unit" name="jumlah-unit" value="1" min="1" required>
      <span class="unit-label">unit</span>
    </div>

    <button class="tambah-properti-button" onclick="tambahProperti()">Tambah Properti</button>

    <div class="property-list" id="property-list" style="display: none;">
      <h3>Daftar Properti</h3>
      <table>
        <thead>
          <tr>
            <th>Fungsi/Kegiatan</th>
            <th>Kategori</th>
            <th>Kelompok Sub-Kategori</th>
            <th>Kode Sub-Kategori</th>
            <th>Luas Unit (m²)</th>
            <th>Jumlah Unit</th>
            <th>Tarif per m² (Rp)</th>
            <th>Total KP (Rp)</th>
          </tr>
        </thead>
        <tbody id="property-items"></tbody>
      </table>
      <div id="total-hasil"></div>

      <!-- Tombol aksi setelah tabel -->
      <div class="action-buttons">
        <button class="simpan-button" onclick="simpanPDF()">Simpan</button>
        <button class="reset-button" onclick="resetSemua()">Reset</button>
      </div>
    </div>
  </div>

  <!-- Modal untuk mengubah tarif -->
  <div id="ubahTarifModal">
    <div>
      <h3>Ubah Tarif</h3>
      <table id="tarifTable">
        <thead>
          <tr>
            <th>Kode Sub-Kategori</th>
            <th>Tarif per m² (Rp)</th>
          </tr>
        </thead>
        <tbody>
          <!-- Baris tarif akan dimasukkan melalui JavaScript -->
        </tbody>
      </table>
      <button onclick="simpanTarifBaru()">Simpan Tarif</button>
      <button onclick="tutupModal()">Batal</button>
    </div>
  </div>

  <script>
    let tarifHunian = {
      H1: 33350,
      H2: 66700,
      H3: 100050,
      H4: 333500
    };

    let tarifNonHunian = {
      'Sarana Umum': {
        NH1: 83160,
        NH2: 166320,
        NH3: 249480
      },
      'Komersial': {
        NH4: 496800,
        NH5: 745200,
        NH6: 993600
      },
      'Industri': {
        NH7: 90890,
        NH8: 681675,
        NH9: 908900
      }
    };

    let propertiList = [];

    function getKategoriDanKelompok(fungsiProyek) {
      const mapping = {
        "Landed House": { kategori: "Hunian", kelompok: "HUNIAN" },
        "Condominium": { kategori: "Hunian", kelompok: "HUNIAN" },
        "Apartment": { kategori: "Hunian", kelompok: "HUNIAN" },
        "University": { kategori: "Non-Hunian", kelompok: "Sarana Umum" },
        "Clinic": { kategori: "Non-Hunian", kelompok: "Sarana Umum" },
        "Laboratory": { kategori: "Non-Hunian", kelompok: "Sarana Umum" },
        "Hospital": { kategori: "Non-Hunian", kelompok: "Sarana Umum" },
        "Recreation": { kategori: "Non-Hunian", kelompok: "Sarana Umum" },
        "Art Building": { kategori: "Non-Hunian", kelompok: "Sarana Umum" },
        "Sports Building": { kategori: "Non-Hunian", kelompok: "Sarana Umum" },
        "Rental Office": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Co-Working Space": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Mall": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Shops": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Function Hall": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Hotel": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Shophouse": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Cafe": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Showroom": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Marketing Office": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Workshop": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Entertainment Venue": { kategori: "Non-Hunian", kelompok: "Komersial" },
        "Factory": { kategori: "Non-Hunian", kelompok: "Industri" },
        "Convection": { kategori: "Non-Hunian", kelompok: "Industri" },
        "Warehouse": { kategori: "Non-Hunian", kelompok: "Industri" },
        "Batching Plant": { kategori: "Non-Hunian", kelompok: "Industri" }
      };
      return mapping[fungsiProyek];
    }

    function hitungTarif(kategori, kelompok, luas) {
      if (kategori === 'Hunian') {
        if (luas <= 35) return tarifHunian.H1;
        else if (luas <= 90) return tarifHunian.H2;
        else if (luas <= 350) return tarifHunian.H3;
        else return tarifHunian.H4;
      } else if (kategori === 'Non-Hunian') {
        const tarifKelompok = tarifNonHunian[kelompok];
        if (!tarifKelompok) return 0;
        if (kelompok === 'Sarana Umum') {
          if (luas <= 500) return tarifKelompok.NH1;
          else if (luas <= 5000) return tarifKelompok.NH2;
          else return tarifKelompok.NH3;
        } else if (kelompok === 'Komersial') {
          if (luas <= 500) return tarifKelompok.NH4;
          else if (luas <= 5000) return tarifKelompok.NH5;
          else return tarifKelompok.NH6;
        } else if (kelompok === 'Industri') {
          if (luas <= 200) return tarifKelompok.NH7;
          else if (luas <= 900) return tarifKelompok.NH8;
          else return tarifKelompok.NH9;
        }
      }
      return 0;
    }

    function hitungKodeSubKategori(kategori, kelompok, luas) {
      if (kategori === 'Hunian') {
        if (luas <= 35) return 'H1';
        else if (luas <= 90) return 'H2';
        else if (luas <= 350) return 'H3';
        else return 'H4';
      } else if (kelompok === 'Sarana Umum') {
        if (luas <= 500) return 'NH1';
        else if (luas <= 5000) return 'NH2';
        else return 'NH3';
      } else if (kelompok === 'Komersial') {
        if (luas <= 500) return 'NH4';
        else if (luas <= 5000) return 'NH5';
        else return 'NH6';
      } else if (kelompok === 'Industri') {
        if (luas <= 200) return 'NH7';
        else if (luas <= 900) return 'NH8';
        else return 'NH9';
      }
      return '';
    }

    function tambahProperti() {
      const fungsiProyek = document.getElementById('fungsi-proyek').value;
      const mapping = getKategoriDanKelompok(fungsiProyek);

      if (!mapping) {
        alert('Fungsi proyek tidak valid.');
        return;
      }

      const kategori = mapping.kategori;
      const kelompok = mapping.kelompok;
      const luasInput = document.getElementById('luas').value;
      const jumlahUnitInput = document.getElementById('jumlah-unit').value;

      const luas = parseFloat(luasInput);
      const jumlahUnit = parseInt(jumlahUnitInput);

      if (isNaN(luas) || luas <= 0) {
        alert('Luas unit harus berupa angka lebih dari 0.');
        return;
      }

      if (isNaN(jumlahUnit) || jumlahUnit <= 0) {
        alert('Jumlah unit harus berupa angka lebih dari 0.');
        return;
      }

      const tarif = hitungTarif(kategori, kelompok, luas);
      const kodeSubKategori = hitungKodeSubKategori(kategori, kelompok, luas);
      const totalKP = luas * jumlahUnit * tarif;

      const properti = {
        fungsi: fungsiProyek,
        kategori: kategori,
        kelompok: kelompok,
        kodeSubKategori: kodeSubKategori,
        luas: luas,
        jumlahUnit: jumlahUnit,
        tarif: tarif,
        totalKP: totalKP
      };

      propertiList.push(properti);
      tampilkanProperti();

      // Reset form setelah menambahkan properti
      resetForm();
    }

    function tampilkanProperti() {
      const propertyItems = document.getElementById('property-items');
      propertyItems.innerHTML = '';

      let totalKeseluruhanKP = 0;
      propertiList.forEach((properti) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${properti.fungsi}</td>
          <td>${properti.kategori}</td>
          <td>${properti.kelompok}</td>
          <td>${properti.kodeSubKategori}</td>
          <td>${properti.luas}</td>
          <td>${properti.jumlahUnit}</td>
          <td>Rp ${properti.tarif.toLocaleString()}</td>
          <td>Rp ${properti.totalKP.toLocaleString()}</td>
        `;
        propertyItems.appendChild(tr);
        totalKeseluruhanKP += properti.totalKP;
      });

      document.getElementById('total-hasil').textContent = `Total Keseluruhan KP: Rp ${totalKeseluruhanKP.toLocaleString()}`;
      document.getElementById('property-list').style.display = 'block';
    }

    function resetForm() {
      document.getElementById('fungsi-proyek').selectedIndex = 0;
      document.getElementById('luas').value = '';
      document.getElementById('jumlah-unit').value = '1';
    }

    function resetSemua() {
      if (confirm("Apakah Anda yakin ingin mereset semua data?")) {
        propertiList = [];
        document.getElementById('property-items').innerHTML = '';
        document.getElementById('total-hasil').textContent = '';
        document.getElementById('property-list').style.display = 'none';
        resetForm();
      }
    }

    function simpanPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(10);

      doc.text("Daftar Properti", 10, 10);

      let yPosition = 20;

      propertiList.forEach((properti, index) => {
        doc.text(`No: ${index + 1}`, 10, yPosition);
        doc.text(`Fungsi/Kegiatan: ${properti.fungsi}`, 10, yPosition + 5);
        doc.text(`Kategori: ${properti.kategori}`, 10, yPosition + 10);
        doc.text(`Kelompok Sub-Kategori: ${properti.kelompok}`, 10, yPosition + 15);
        doc.text(`Kode Sub-Kategori: ${properti.kodeSubKategori}`, 10, yPosition + 20);
        doc.text(`Luas (m²): ${properti.luas}`, 10, yPosition + 25);
        doc.text(`Jumlah Unit: ${properti.jumlahUnit}`, 10, yPosition + 30);
        doc.text(`Tarif per m² (Rp): Rp ${properti.tarif.toLocaleString()}`, 10, yPosition + 35);
        doc.text(`Total KP (Rp): Rp ${properti.totalKP.toLocaleString()}`, 10, yPosition + 40);
        yPosition += 50;

        if (yPosition > 270) {
          doc.addPage();
          yPosition = 20;
        }
      });

      doc.save("Daftar_Properti.pdf");
    }

    function ubahTarif() {
      const modal = document.getElementById('ubahTarifModal');
      const tarifTableBody = document.querySelector('#tarifTable tbody');
      tarifTableBody.innerHTML = '';

      const tarifData = [
        { kode: 'H1', tarif: tarifHunian.H1 },
        { kode: 'H2', tarif: tarifHunian.H2 },
        { kode: 'H3', tarif: tarifHunian.H3 },
        { kode: 'H4', tarif: tarifHunian.H4 },
        { kode: 'NH1', tarif: tarifNonHunian['Sarana Umum'].NH1 },
        { kode: 'NH2', tarif: tarifNonHunian['Sarana Umum'].NH2 },
        { kode: 'NH3', tarif: tarifNonHunian['Sarana Umum'].NH3 },
        { kode: 'NH4', tarif: tarifNonHunian['Komersial'].NH4 },
        { kode: 'NH5', tarif: tarifNonHunian['Komersial'].NH5 },
        { kode: 'NH6', tarif: tarifNonHunian['Komersial'].NH6 },
        { kode: 'NH7', tarif: tarifNonHunian['Industri'].NH7 },
        { kode: 'NH8', tarif: tarifNonHunian['Industri'].NH8 },
        { kode: 'NH9', tarif: tarifNonHunian['Industri'].NH9 }
      ];

      tarifData.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.kode}</td>
          <td><input type="number" value="${item.tarif}" id="tarif-${item.kode}" /></td>
        `;
        tarifTableBody.appendChild(row);
      });

      modal.style.display = 'flex';
    }

    function simpanTarifBaru() {
      const tarifData = [
        'H1', 'H2', 'H3', 'H4',
        'NH1', 'NH2', 'NH3',
        'NH4', 'NH5', 'NH6',
        'NH7', 'NH8', 'NH9'
      ];

      tarifData.forEach(kode => {
        const input = document.getElementById(`tarif-${kode}`);
        const nilaiBaru = parseInt(input.value);
        if (!isNaN(nilaiBaru)) {
          if (kode.startsWith('H')) {
            tarifHunian[kode] = nilaiBaru;
          } else {
            if (kode.startsWith('NH1') || kode.startsWith('NH2') || kode.startsWith('NH3')) {
              tarifNonHunian['Sarana Umum'][kode] = nilaiBaru;
            } else if (kode.startsWith('NH4') || kode.startsWith('NH5') || kode.startsWith('NH6')) {
              tarifNonHunian['Komersial'][kode] = nilaiBaru;
            } else if (kode.startsWith('NH7') || kode.startsWith('NH8') || kode.startsWith('NH9')) {
              tarifNonHunian['Industri'][kode] = nilaiBaru;
            }
          }
        }
      });

      alert('Tarif berhasil diubah.');
      tutupModal();
    }

    function tutupModal() {
      const modal = document.getElementById('ubahTarifModal');
      modal.style.display = 'none';
    }
  </script>
</body>
</html>
